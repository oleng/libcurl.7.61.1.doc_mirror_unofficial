<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML>
<HEAD> <TITLE>libcurl - Security Considerations</TITLE>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
<link rel="stylesheet" type="text/css" href="css/curl.css">
<link rel="shortcut icon" href="../favicon.ico">
<link rel="icon" href="curl-symbol.svg" type="image/svg+xml">
<link rel="STYLESHEET" type="text/css" href="../manpage.css">
</HEAD>
<body bgcolor="#ffffff" text="#000000">
<div class="main">
<div class="menu">
<a href="index.html" class="menuitem" title="Front page of the libcurl section">libcurl index</a>
<a href="abi.html" class="menuitem" title="ABI guarantees between releases and more ">ABI</a>
<a href="c/index.html" class="menuitem" title="Functions provided by libcurl ">API</a>
<a href="bindings.html" class="menuitem" title="Using libcurl powers within your language of choice! ">Bindings</a>
<a href="competitors.html" class="menuitem" title="Figure what competing libraries there are ">Competitors</a>
<a href="c/example.html" class="menuitem" title="Educational snippets of code ">Examples</a>
<a href="features.html" class="menuitem" title="What makes libcurl special ">Features</a>
<a href="https://curl.haxx.se/mail/list.cgi?list=curl-library" class="menuitem" title="curl-library mailing list info and archives">Mailing List</a>
<a href="relatedlibs.html" class="menuitem" title="Related libraries that you might find useful together with libcurl">Related Libs</a>
<a href="using/index.html" class="menuitem" title="How to use libcurl section">Using libcurl</a>
<a href="security.html" class="itemselect">Security </a>
<a href="c/libcurl-tutorial.html" class="menuitem" title="libcurl programming tutorial">Tutorial</a>
<a href="theysay.html" class="menuitem" title="What developers using libcurl say about it">Testimonials</a>
</div>
<div class="contents">
<div class="where"><a href="https://curl.haxx.se/">curl</a> / <a href="index.html">libcurl</a> / <b>libcurl Security Considerations</b></div>
<h1> libcurl security considerations </h1>
<div class="relatedbox">
<b>Related:</b>
<br><a href="c/example.html">Examples</a>
<br><a href="c/index.html">API</a>
</div>
<!-- generated with roffit -->
<p class="level0"><a name="NAME"></a><h2 class="nroffsh">NAME</h2>
<p class="level0">libcurl-security - security considerations when using libcurl <a name="Security"></a><h2 class="nroffsh">Security</h2>
<p class="level0">The libcurl project takes security seriously.  The library is written with caution and precautions are taken to mitigate many kinds of risks encountered while operating with potentially malicious servers on the Internet. It is a powerful library, however, which allows application writers to make trade-offs between ease of writing and exposure to potential risky operations. If used the right way, you can use libcurl to transfer data pretty safely.
<p class="level0">Many applications are used in closed networks where users and servers can (possibly) be trusted, but many others are used on arbitrary servers and are fed input from potentially untrusted users.  Following is a discussion about some risks in the ways in which applications commonly use libcurl and potential mitigations of those risks. It is by no means comprehensive, but shows classes of attacks that robust applications should consider. The Common Weakness Enumeration project at <a href="https://cwe.mitre.org/">https://cwe.mitre.org/</a> is a good reference for many of these and similar types of weaknesses of which application writers should be aware. <a name="Command"></a><h2 class="nroffsh">Command Lines</h2>
<p class="level0">If you use a command line tool (such as curl) that uses libcurl, and you give options to the tool on the command line those options can very likely get read by other users of your system when they use 'ps' or other tools to list currently running processes.
<p class="level0">To avoid these problems, never feed sensitive things to programs using command line options. Write them to a protected file and use the -K option to avoid this. <a name="netrc"></a><h2 class="nroffsh">.netrc</h2>
<p class="level0">.netrc is a pretty handy file/feature that allows you to login quickly and automatically to frequently visited sites. The file contains passwords in clear text and is a real security risk. In some cases, your .netrc is also stored in a home directory that is NFS mounted or used on another network based file system, so the clear text password will fly through your network every time anyone reads that file!
<p class="level0">For applications that enable .netrc use, a user who manage to set the right URL might then be possible to pass on passwords.
<p class="level0">To avoid these problems, don't use .netrc files and never store passwords in plain text anywhere. <a name="Clear"></a><h2 class="nroffsh">Clear Text Passwords</h2>
<p class="level0">Many of the protocols libcurl supports send name and password unencrypted as clear text (HTTP Basic authentication, FTP, TELNET etc). It is very easy for anyone on your network or a network nearby yours to just fire up a network analyzer tool and eavesdrop on your passwords. Don't let the fact that HTTP Basic uses base64 encoded passwords fool you. They may not look readable at a first glance, but they very easily "deciphered" by anyone within seconds.
<p class="level0">To avoid this problem, use an authentication mechanism or other protocol that doesn't let snoopers see your password: Digest, CRAM-MD5, Kerberos, SPNEGO or NTLM authentication. Or even better: use authenticated protocols that protect the entire connection and everything sent over it. <a name="Un-authenticated"></a><h2 class="nroffsh">Un-authenticated Connections</h2>
<p class="level0">Protocols that don't have any form of cryptographic authentication cannot with any certainty know that they communicate with the right remote server.
<p class="level0">If your application is using a fixed scheme or fixed host name, it is not safe as long as the connection is un-authenticated. There can be a man-in-the-middle or in fact the whole server might have been replaced by an evil actor.
<p class="level0">Un-authenticated protocols are unsafe. The data that comes back to curl may have been injected by an attacker. The data that curl sends might be modified before it reaches the intended server. If it even reaches the intended server at all.
<p class="level0">Remedies:
<p class="level0"><a name="Restrict"></a><span class="nroffip">Restrict operations to authenticated transfers</span>
<p class="level1">Ie use authenticated protocols protected with HTTPS or SSH.
<p class="level0"><a name="Make"></a><span class="nroffip">Make sure the server's certificate etc is verified</span>
<p class="level1">Never ever switch off certificate verification. <a name="Redirects"></a><h2 class="nroffsh">Redirects</h2>
<p class="level0">The <a Class="emphasis" href="https://curl.haxx.se/libcurl/CURLOPT_FOLLOWLOCATION.html">CURLOPT_FOLLOWLOCATION</a> option automatically follows HTTP redirects sent by a remote server.  These redirects can refer to any kind of URL, not just HTTP. libcurl restricts the protocols allowed to be used in redirects for security reasons: FILE, SCP, SMB and SMBS are disabled by default. Applications are encouraged to restrict that set further.
<p class="level0">A redirect to a file: URL would cause the libcurl to read (or write) arbitrary files from the local filesystem.  If the application returns the data back to the user (as would happen in some kinds of CGI scripts), an attacker could leverage this to read otherwise forbidden data (e.g. file://localhost/etc/passwd).
<p class="level0">If authentication credentials are stored in the ~/.netrc file, or Kerberos is in use, any other URL type (not just file:) that requires authentication is also at risk.  A redirect such as <a href="ftp://some-internal-server/private-file">ftp://some-internal-server/private-file</a> would then return data even when the server is password protected.
<p class="level0">In the same way, if an unencrypted SSH private key has been configured for the user running the libcurl application, SCP: or SFTP: URLs could access password or private-key protected resources, e.g. sftp://user@some-internal-server/etc/passwd
<p class="level0">The <a Class="emphasis" href="https://curl.haxx.se/libcurl/CURLOPT_REDIR_PROTOCOLS.html">CURLOPT_REDIR_PROTOCOLS</a> and <a Class="emphasis" href="https://curl.haxx.se/libcurl/CURLOPT_NETRC.html">CURLOPT_NETRC</a> options can be used to mitigate against this kind of attack.
<p class="level0">A redirect can also specify a location available only on the machine running libcurl, including servers hidden behind a firewall from the attacker. e.g. <a href="http://127.0.0.1/">http://127.0.0.1/</a> or <a href="http://intranet/delete-stuff.cgi?delete=all">http://intranet/delete-stuff.cgi?delete=all</a> or tftp://bootp-server/pc-config-data
<p class="level0">Applications can mitigate against this by disabling <a Class="emphasis" href="https://curl.haxx.se/libcurl/CURLOPT_FOLLOWLOCATION.html">CURLOPT_FOLLOWLOCATION</a> and handling redirects itself, sanitizing URLs as necessary. Alternately, an app could leave <a Class="emphasis" href="https://curl.haxx.se/libcurl/CURLOPT_FOLLOWLOCATION.html">CURLOPT_FOLLOWLOCATION</a> enabled but set <a Class="emphasis" href="https://curl.haxx.se/libcurl/CURLOPT_REDIR_PROTOCOLS.html">CURLOPT_REDIR_PROTOCOLS</a> and install a <a Class="emphasis" href="https://curl.haxx.se/libcurl/CURLOPT_OPENSOCKETFUNCTION.html">CURLOPT_OPENSOCKETFUNCTION</a> callback function in which addresses are sanitized before use. <a name="Local"></a><h2 class="nroffsh">Local Resources</h2>
<p class="level0">A user who can control the DNS server of a domain being passed in within a URL can change the address of the host to a local, private address which a server-side libcurl-using application could then use. e.g. the innocuous URL <a href="http://fuzzybunnies.example.com/">http://fuzzybunnies.example.com/</a> could actually resolve to the IP address of a server behind a firewall, such as 127.0.0.1 or 10.1.2.3.  Applications can mitigate against this by setting a <a Class="emphasis" href="https://curl.haxx.se/libcurl/CURLOPT_OPENSOCKETFUNCTION.html">CURLOPT_OPENSOCKETFUNCTION</a> and checking the address before a connection.
<p class="level0">All the malicious scenarios regarding redirected URLs apply just as well to non-redirected URLs, if the user is allowed to specify an arbitrary URL that could point to a private resource. For example, a web app providing a translation service might happily translate file://localhost/etc/passwd and display the result.  Applications can mitigate against this with the <a Class="emphasis" href="https://curl.haxx.se/libcurl/CURLOPT_PROTOCOLS.html">CURLOPT_PROTOCOLS</a> option as well as by similar mitigation techniques for redirections.
<p class="level0">A malicious FTP server could in response to the PASV command return an IP address and port number for a server local to the app running libcurl but behind a firewall.  Applications can mitigate against this by using the <a Class="emphasis" href="https://curl.haxx.se/libcurl/CURLOPT_FTP_SKIP_PASV_IP.html">CURLOPT_FTP_SKIP_PASV_IP</a> option or <a Class="emphasis" href="https://curl.haxx.se/libcurl/CURLOPT_FTPPORT.html">CURLOPT_FTPPORT</a>.
<p class="level0">Local servers sometimes assume local access comes from friends and trusted users. An application that expects <a href="http://example.com/file_to_read">http://example.com/file_to_read</a> that and instead gets <a href="http://192.168.0.1/my_router_config">http://192.168.0.1/my_router_config</a> might print a file that would otherwise be protected by the firewall.
<p class="level0">Allowing your application to connect to local hosts, be it the same machine that runs the application or a machine on the same local network, might be possible to exploit by an attacker who then perhaps can "port-scan" the particular hosts - depending on how the application and servers acts. <a name="IPv6"></a><h2 class="nroffsh">IPv6 Addresses</h2>
<p class="level0">libcurl will normally handle IPv6 addresses transparently and just as easily as IPv4 addresses. That means that a sanitizing function that filters out addresses like 127.0.0.1 isn't sufficient--the equivalent IPv6 addresses ::1, ::, 0:00::0:1, ::127.0.0.1 and ::ffff:7f00:1 supplied somehow by an attacker would all bypass a naive filter and could allow access to undesired local resources.  IPv6 also has special address blocks like link-local and site-local that generally shouldn't be accessed by a server-side libcurl-using application.  A poorly-configured firewall installed in a data center, organization or server may also be configured to limit IPv4 connections but leave IPv6 connections wide open.  In some cases, setting <a Class="emphasis" href="https://curl.haxx.se/libcurl/CURLOPT_IPRESOLVE.html">CURLOPT_IPRESOLVE</a> to CURL_IPRESOLVE_V4 can be used to limit resolved addresses to IPv4 only and bypass these issues. <a name="Uploads"></a><h2 class="nroffsh">Uploads</h2>
<p class="level0">When uploading, a redirect can cause a local (or remote) file to be overwritten. Applications must not allow any unsanitized URL to be passed in for uploads. Also, <a Class="emphasis" href="https://curl.haxx.se/libcurl/CURLOPT_FOLLOWLOCATION.html">CURLOPT_FOLLOWLOCATION</a> should not be used on uploads.  Instead, the applications should consider handling redirects itself, sanitizing each URL first. <a name="Authentication"></a><h2 class="nroffsh">Authentication</h2>
<p class="level0">Use of <a Class="emphasis" href="https://curl.haxx.se/libcurl/CURLOPT_UNRESTRICTED_AUTH.html">CURLOPT_UNRESTRICTED_AUTH</a> could cause authentication information to be sent to an unknown second server.  Applications can mitigate against this by disabling <a Class="emphasis" href="https://curl.haxx.se/libcurl/CURLOPT_FOLLOWLOCATION.html">CURLOPT_FOLLOWLOCATION</a> and handling redirects itself, sanitizing where necessary.
<p class="level0">Use of the CURLAUTH_ANY option to <a Class="emphasis" href="https://curl.haxx.se/libcurl/CURLOPT_HTTPAUTH.html">CURLOPT_HTTPAUTH</a> could result in user name and password being sent in clear text to an HTTP server.  Instead, use CURLAUTH_ANYSAFE which ensures that the password is encrypted over the network, or else fail the request.
<p class="level0">Use of the CURLUSESSL_TRY option to <a Class="emphasis" href="https://curl.haxx.se/libcurl/CURLOPT_USE_SSL.html">CURLOPT_USE_SSL</a> could result in user name and password being sent in clear text to an FTP server.  Instead, use CURLUSESSL_CONTROL to ensure that an encrypted connection is used or else fail the request. <a name="Cookies"></a><h2 class="nroffsh">Cookies</h2>
<p class="level0">If cookies are enabled and cached, then a user could craft a URL which performs some malicious action to a site whose authentication is already stored in a cookie. e.g. <a href="http://mail.example.com/delete-stuff.cgi?delete=all">http://mail.example.com/delete-stuff.cgi?delete=all</a> Applications can mitigate against this by disabling cookies or clearing them between requests. <a name="Dangerous"></a><h2 class="nroffsh">Dangerous SCP URLs</h2>
<p class="level0">SCP URLs can contain raw commands within the scp: URL, which is a side effect of how the SCP protocol is designed. e.g.
<p class="level0">&nbsp; scp://user:pass@host/a;date &gt;/tmp/test;
<p class="level0">Applications must not allow unsanitized SCP: URLs to be passed in for downloads. <a name="file"></a><h2 class="nroffsh">file://</h2>
<p class="level0">By default curl and libcurl support file:// URLs. Such a URL is always an access, or attempted access, to a local resource. If your application wants to avoid that, keep control of what URLs to use and/or prevent curl/libcurl from using the protocol.
<p class="level0">By default, libcurl prohibits redirects to file:// URLs. <a name="What"></a><h2 class="nroffsh">What if the user can set the URL</h2>
<p class="level0">Applications may find it tempting to let users set the URL that it can work on. That's probably fine, but opens up for mischief and trickery that you as an application author may want to address or take precautions against.
<p class="level0">If your curl-using script allow a custom URL do you also, perhaps unintentionally, allow the user to pass other options to the curl command line if creative use of special characters are applied?
<p class="level0">If the user can set the URL, the user can also specify the scheme part to other protocols that you didn't intend for users to use and perhaps didn't consider. curl supports over 20 different URL schemes. "http://" might be what you thought, "ftp://" or "imap://" might be what the user gives your application. Also, cross-protocol operations might be done by using a particular scheme in the URL but point to a server doing a different protocol on a non-standard port.
<p class="level0">Remedies:
<p class="level0"><a name="Use"></a><span class="nroffip">Use --proto</span>
<p class="level1">curl command lines can use <span Class="emphasis">--proto</span> to limit what URL schemes it accepts
<p class="level0"><a name="Use"></a><span class="nroffip">Use CURLOPT_PROTOCOLS</span>
<p class="level1">libcurl programs can use <a Class="emphasis" href="https://curl.haxx.se/libcurl/CURLOPT_PROTOCOLS.html">CURLOPT_PROTOCOLS</a> to limit what URL schemes it accepts
<p class="level0"><a name="consider"></a><span class="nroffip">consider not allowing the user to set the full URL</span>
<p class="level1">Maybe just let the user provide data for parts of it? Or maybe filter input to only allow specific choices? <a name="RFC"></a><h2 class="nroffsh">RFC 3986 vs WHATWG URL</h2>
<p class="level0">curl supports URLs mostly according to how they are defined in <a href="http://www.ietf.org/rfc/rfc3986.txt">RFC 3986</a>, and has done so since the beginning.
<p class="level0">Web browsers mostly adhere to the WHATWG URL Specification.
<p class="level0">This deviance makes some URLs copied between browsers (or returned over HTTP for redirection) and curl not work the same way. This can mislead users into getting the wrong thing, connecting to the wrong host or otherwise not work identically. <a name="FTP"></a><h2 class="nroffsh">FTP uses two connections</h2>
<p class="level0">When performing an FTP transfer, two TCP connections are used: one for setting up the transfer and one for the actual data.
<p class="level0">FTP is not only un-authenticated, but the setting up of the second transfer is also a weak spot. The second connection to use for data, is either setup with the PORT/EPRT command that makes the server connect back to the client on the given IP+PORT, or with PASV/EPSV that makes the server setup a port to listen to and tells the client to connect to a given IP+PORT.
<p class="level0">Again, un-authenticated means that the connection might be meddled with by a man-in-the-middle or that there's a malicious server pretending to be the right one.
<p class="level0">A malicious FTP server can respond to PASV commands with the IP+PORT of a totally different machine. Perhaps even a third party host, and when there are many clients trying to connect to that third party, it could create a Distributed Denial-Of-Service attack out of it! If the client makes an upload operation, it can make the client send the data to another site. If the attacker can affect what data the client uploads, it can be made to work as a HTTP request and then the client could be made to issue HTTP requests to third party hosts.
<p class="level0">An attacker that manages to control curl's command line options can tell curl to send an FTP PORT command to ask the server to connect to a third party host instead of back to curl.
<p class="level0">The fact that FTP uses two connections makes it vulnerable in a way that is hard to avoid. <a name="Denial"></a><h2 class="nroffsh">Denial of Service</h2>
<p class="level0">A malicious server could cause libcurl to effectively hang by sending data very slowly, or even no data at all but just keeping the TCP connection open. This could effectively result in a denial-of-service attack. The <a Class="emphasis" href="https://curl.haxx.se/libcurl/CURLOPT_TIMEOUT.html">CURLOPT_TIMEOUT</a> and/or <a Class="emphasis" href="https://curl.haxx.se/libcurl/CURLOPT_LOW_SPEED_LIMIT.html">CURLOPT_LOW_SPEED_LIMIT</a> options can be used to mitigate against this.
<p class="level0">A malicious server could cause libcurl to download an infinite amount of data, potentially causing all of memory or disk to be filled. Setting the <a Class="emphasis" href="https://curl.haxx.se/libcurl/CURLOPT_MAXFILESIZE_LARGE.html">CURLOPT_MAXFILESIZE_LARGE</a> option is not sufficient to guard against this.  Instead, applications should monitor the amount of data received within the write or progress callback and abort once the limit is reached.
<p class="level0">A malicious HTTP server could cause an infinite redirection loop, causing a denial-of-service. This can be mitigated by using the <a Class="emphasis" href="https://curl.haxx.se/libcurl/CURLOPT_MAXREDIRS.html">CURLOPT_MAXREDIRS</a> option. <a name="Arbitrary"></a><h2 class="nroffsh">Arbitrary Headers</h2>
<p class="level0">User-supplied data must be sanitized when used in options like <a Class="emphasis" href="https://curl.haxx.se/libcurl/CURLOPT_USERAGENT.html">CURLOPT_USERAGENT</a>, <a Class="emphasis" href="https://curl.haxx.se/libcurl/CURLOPT_HTTPHEADER.html">CURLOPT_HTTPHEADER</a>, <a Class="emphasis" href="https://curl.haxx.se/libcurl/CURLOPT_POSTFIELDS.html">CURLOPT_POSTFIELDS</a> and others that are used to generate structured data. Characters like embedded carriage returns or ampersands could allow the user to create additional headers or fields that could cause malicious transactions. <a name="Server-supplied"></a><h2 class="nroffsh">Server-supplied Names</h2>
<p class="level0">A server can supply data which the application may, in some cases, use as a file name. The curl command-line tool does this with <span Class="emphasis">--remote-header-name</span>, using the Content-disposition: header to generate a file name.  An application could also use <a Class="emphasis" href="https://curl.haxx.se/libcurl/CURLINFO_EFFECTIVE_URL.html">CURLINFO_EFFECTIVE_URL</a> to generate a file name from a server-supplied redirect URL. Special care must be taken to sanitize such names to avoid the possibility of a malicious server supplying one like "/etc/passwd", "\autoexec.bat", "prn:" or even ".bashrc". <a name="Server"></a><h2 class="nroffsh">Server Certificates</h2>
<p class="level0">A secure application should never use the <a Class="emphasis" href="https://curl.haxx.se/libcurl/CURLOPT_SSL_VERIFYPEER.html">CURLOPT_SSL_VERIFYPEER</a> option to disable certificate validation. There are numerous attacks that are enabled by applications that fail to properly validate server TLS/SSL certificates, thus enabling a malicious server to spoof a legitimate one. HTTPS without validated certificates is potentially as insecure as a plain HTTP connection. <a name="Report"></a><h2 class="nroffsh">Report Security Problems</h2>
<p class="level0">Should you detect or just suspect a security problem in libcurl or curl, contact the project curl security team immediately. See <a href="https://curl.haxx.se/dev/secprocess.html">https://curl.haxx.se/dev/secprocess.html</a> for details. <a name="Showing"></a><h2 class="nroffsh">Showing What You Do</h2>
<p class="level0">Relatedly, be aware that in situations when you have problems with libcurl and ask someone for help, everything you reveal in order to get best possible help might also impose certain security related risks. Host names, user names, paths, operating system specifics, etc. (not to mention passwords of course) may in fact be used by intruders to gain additional information of a potential target.
<p class="level0">Be sure to limit access to application logs if they could hold private or security-related data.  Besides the obvious candidates like user names and passwords, things like URLs, cookies or even file names could also hold sensitive data.
<p class="level0">To avoid this problem, you must of course use your common sense. Often, you can just edit out the sensitive data or just search/replace your true information with faked data.
<p class="level0"><p class="roffit">
 This HTML page was made with <a href="http://daniel.haxx.se/projects/roffit/">roffit</a>.
</div>
</div>

</BODY>
</HTML>
